###2.3.1 RTMP协议
实时消息传递协议(RTMP)是为了在Adobeflash平台技术(包括adobeflash Player和adobeair)之间高性能传输音频、视频和数据而设计的。RTMP现在可以作为一个开放的规范来创建产品和技术，可以在open AMF、SWF、FLV和F4V格式中提供与adobeflashplayer兼容的视频、音频和数据。
 
####关键特性

RTMP协议是应用层协议，是要靠底层可靠的传输层协议（通常是TCP）来保证信息传输的可靠性的。在基于传输层协议的链接建立完成后，RTMP协议也要客户端和服务器通过“握手”来建立基于传输层链接之上的RTMP Connection链接，在Connection链接上会传输一些控制信息，如SetChunkSize,SetACKWindowSize。其中CreateStream命令会创建一个Stream链接，用于传输具体的音视频数据和控制这些信息传输的命令信息。RTMP协议传输时会对数据做自己的格式化，这种格式的消息我们称之为RTMP Message，而实际传输的时候为了更好地实现多路复用、分包和信息的公平性，发送端会把Message划分为带有Message ID的Chunk，每个Chunk可能是一个单独的Message，也可能是Message的一部分，在接受端会根据chunk中包含的data的长度，message id和message的长度把chunk还原成完整的Message，从而实现信息的收发。

####握手
 一个RTMP连接以握手开始。这里的握手和其他协议的握手不一样。这里的握手由三个固定大小的chunk组成，而不是可变大小的chunk加上头。
客户端（发起连接的一方）和服务端各自发送三个相同的块。这些块如果是客户端发送的话记为C0，C1和C2，如果是服务端发送的话记为S0，S1和S2，如图2-1所示。

**过程**
- 客户端要等收到S1之后才能发送C2
- 客户端要等收到S2之后才能发送其他信息（控制信息和真实音视频等数据）
- 服务端要等到收到C0之后发送S1
- 服务端必须等到收到C1之后才能发送S2
- 服务端必须等到收到C2之后才能发送其他信息（控制信息和真实音视频等数据）
  
![](/assets/微信截图_20180122112043.png)
图2-1